/* ==UserStyle==
@name           Dheatly's Custom Patches for Youtube
@namespace      github.com/Dheatly23/Custom-Patches-For-Youtube
@version        0.0.11
@description    Mostly custom patches for `AdashimaaTube. Please match the configuration to it.
@author         Dheatly23
@preprocessor   stylus
@homepageURL https://github.com/Dheatly23/Custom-Patches-For-Youtube
@supportURL https://github.com/Dheatly23/Custom-Patches-For-Youtube
@license Apache-2.0

@var range borderRadius                "â€ƒâ€ƒâš™ï¸ Border Radius" [0, 0, 40, 1, 'px']
@var range buttonRadius                "â€ƒâ€ƒâš™ï¸ Buttons Radius" [2, 0, 18, 1, 'px']
@var range profileRadius               "â€ƒâ€ƒâš™ï¸ Profiles Radius" [50, 0, 50, 1, '%']
@var checkbox  searchSideDisable        "Disable search sidebar" 0
@var text  searchSideWidth             "Sidebar width" 100px
==/UserStyle== */
@-moz-document domain("www.youtube.com") {
    /* Fix margins */
    ytd-rich-item-renderer:is(.ytd-rich-grid-renderer, .ytd-rich-shelf-renderer) {
        margin-left: calc(var(--ytd-rich-grid-item-margin) / 2) !important;
        margin-right: calc(var(--ytd-rich-grid-item-margin) / 2) !important;
        margin-bottom: calc(var(--ytd-rich-grid-item-margin) / 2) !important;
    }

    ytd-rich-item-renderer.ytd-rich-grid-renderer {
        width: calc(100% / var(--video-per-row) - var(--ytd-rich-grid-item-margin) - 0.01px) !important;
    }

    ytd-rich-item-renderer.ytd-rich-shelf-renderer[is-shelf-item] {
        width: calc(100% / var(--ytd-rich-grid-slim-items-per-row) - var(--ytd-rich-grid-item-margin) - 0.01px) !important;
        /* Patch shorts */
        &:not([hidden]) {
            display: block !important;
        }
    }

    [page-subtype = "channels"],
    [page-subtype = "subscriptions"] :is(ytd-rich-grid-renderer, ytd-rich-shelf-renderer) {
        --ytd-rich-grid-item-margin: 2px !important;
        --ytd-rich-grid-row-margin: 2px !important;
    }

    /* Community post full width */
    [page-subtype = "channels"] ytd-section-list-renderer > #contents > :is(ytd-backstage-items, ytd-comments) {
        max-width: 100%;
    }

    /* Channel video full width */
    [page-subtype = "channels"] ytd-two-column-browse-results-renderer.ytd-browse {
        max-width: unset;
        width: 100% !important;

        > #primary {
            padding-inline: 0px !important;
        }
    }

    /* Subscription box full width */
    [page-subtype = "subscriptions"] ytd-two-column-browse-results-renderer.ytd-browse.grid {
        width: 100% !important;
    }

    /* Small buttons for recommended videos */
    yt-lockup-metadata-view-model {
        > .yt-lockup-metadata-view-model__text-container > h3 > a {
            padding-right: 16px;
        }

        > .yt-lockup-metadata-view-model__menu-button {
            right: 0px;

            > button-view-model > button[aria-label = "More actions"] {
                width: 16px;
            }
        }
    }

    /* Small buttons for shorts */
    ytm-shorts-lockup-view-model {
        > .shortsLockupViewModelHostOutsideMetadata {
            padding-top: 0.2rem;
        }

        > .shortsLockupViewModelHostOutsideMetadataHasMenu {
            padding-right: 16px;

            > .shortsLockupViewModelHostOutsideMetadataMenu > button {
                width: 16px;
            }
        }
    }

    /* Reduce padding on about
    #channel-tagline.ytd-c4-tabbed-header-renderer {
        ytd-channel-tagline-renderer.ytd-c4-tabbed-header-renderer {
            padding: 0px;
        }
    }
    */
    /* Channel avatar live ring -> square and image too */
    yt-avatar-shape {
        div.yt-spec-avatar-shape--live-ring::after,
        img.yt-spec-avatar-shape__image {
            border-radius: profileRadius;
        }

        /* Patch image mask for collab BS */
        div {
            mask-image: unset !important;
        }
    }

    /* Fix shorts thumbnail */
    ytm-shorts-lockup-view-model > a > div.shortsLockupViewModelHostThumbnailParentContainerRounded,
    /* Fix channel banner */
    yt-image-banner-view-model,
    /* Fix video thumbnail */
    yt-thumbnail-view-model,
    /* Pinned live chat message */
    yt-live-chat-banner-renderer {
        border-radius: borderRadius !important;
    }

    /* Fix comment thumbnail */
    #author-thumbnail.ytd-comment-view-model yt-img-shadow.ytd-comment-view-model {
        border-radius: profileRadius;
    }

    /* Fix buttons */
    button.yt-spec-button-shape-next {
        border-radius: buttonRadius;
    }

    /* Fix border for extra stuff in description */
    .ytVideoMetadataCarouselViewModelHost,
    /* Emoji search box */
    yt-emoji-picker-renderer > #search-panel.yt-emoji-picker-renderer,
    /* Chat input box */
    yt-live-chat-message-input-renderer.yt-live-chat-renderer > #container > #top > #input-container {
        border-radius: borderRadius;
    }

    /* Watch page */
    ytd-watch-flexy:not([hidden]) {
        ytd-player > #container > #movie_player {
            /* Fix tooltip (also partial revert) */
            > .ytp-tooltip {
                padding: 0px;

                &,
                * {
                    border-radius: borderRadius;
                }
            }

            /* Hide fullscreen quick action BS */
            > .ytp-overlays-container > .ytp-overlay-bottom-right > .ytp-fullscreen-quick-actions {
                display: none;
            }
        }

        > #columns {
            > #primary > #primary-inner > #below {
                /* Fix border of "clarify box" */
                > #clarify-box > ytd-info-panel-container-renderer {
                    ytd-info-panel-content-renderer {
                        border-bottom-left-radius: borderRadius;
                        border-bottom-right-radius: borderRadius;
                    }
                }

                /* Replace another bullshit box */
                > ytd-watch-metadata ytd-info-panel-content-renderer {
                    border-radius: borderRadius;

                    &:not(:hover) {
                        yt-icon.inline-icon,
                        #menu {
                            display: none;
                        }

                        div.paragraphs.ytd-info-panel-content-renderer {
                            > div.style-scope.ytd-info-panel-content-renderer > yt-formatted-string {
                                &::before {
                                    /* Some hideous replacement here */
                                    content: "Youtube Verifiesâ˜‘ that \22";
                                }

                                &::after {
                                    /* Some hideous replacement here */
                                    content: "\22  (total lies ðŸ™„)";
                                }
                            }

                            > div.ytd-info-panel-content-renderer.disclaimer-container,
                            > div.style-scope.ytd-info-panel-content-renderer > div.inline-source:not([hidden]) {
                                > * {
                                    display: none;
                                }

                                &::after {
                                    /* Some hideous replacement here */
                                    content: "Youtube wants to fuck your mind and rewrite freedom to think. With our infinite wisdom, we replaced this bullshit, useless box, that you won\'t ever read with our own text. ðŸ¤£ (Hover over to \22restore\22  to original)";
                                    color: var(--yt-spec-text-primary);
                                }
                            }
                        }
                    }
                }

                /* More marie kondo */
                > :is(#ticket-shelf, #shopping-timely-shelf) {
                    display: none;
                }
            }

            > #secondary {
                ytd-item-section-renderer > #contents {
                    /* Weird channel in related */
                    > ytd-channel-renderer {
                        display: none;
                    }

                    /* Fix margins */
                    > .ytd-item-section-renderer {
                        margin-top: 0.2em;
                    }
                }
            }
        }

        &:not([fullscreen]) {
            > #columns {
                > #primary {
                    /* Fix margins */
                    /* margin-left: 0px; */
                    padding-right: 0px;
                    padding-top: 0.5rem;
                }

                > #secondary {
                    /* Fix margins */
                    padding-left: 0.75rem;
                    padding-right: 0px;
                    padding-top: 0.5rem;
                    width: calc(var(--ytd-watch-flexy-sidebar-width) + 32px - 0.75rem);
                }
            }
        }
    }

    /* Comments */
    ytd-comments > ytd-item-section-renderer {
        /* Remove excessive margin for header */
        > #header > ytd-comments-header-renderer {
            margin-top: 0px;
            margin-bottom: 1lh;

            > #title {
                margin-bottom: 1lh;
            }
        }

        > #contents {
            /* No skeleton in my backyard */
            ytd-continuation-item-renderer {
                > #ghost-comment-section {
                    display: none;
                }

                > tp-yt-paper-spinner {
                    margin: 0px;
                }
            }

            /* Fix margin between items */
            > ytd-comment-thread-renderer {
                margin-bottom: 0px;
            }
        }
    }

    /* Fix search box */
    yt-searchbox {
        margin-left: 0px;
        margin-right: 0px;

        :is(.ytSearchboxComponentInputBox, .ytSearchboxComponentSearchButton, .ytSearchboxComponentSuggestionsContainer, .ytSuggestionComponentRoundedSuggestion) {
            border-radius: borderRadius;
        }

        .ytSearchboxComponentSuggestionsContainer {
            padding-top: 0px;
            padding-bottom: 0px;
        }

        .ytSuggestionComponentSuggestion {
            margin-left: 0px;
            margin-right: 0px;
            padding-left: 8px;
            padding-right: 8px;
        }
    }

    /* Search page */
    ytd-search.ytd-page-manager > #container {
        /* Search sidebar stuff */
        > ytd-two-column-search-results-renderer {
            > #primary {
                max-width: 100%;
            }

            > ytd-secondary-search-container-renderer#secondary {
                padding-left: 0px;
                width: searchSideWidth;
                display: none if searchSideDisable;
            }
        }

        /* Fix margin */
        --ytd-rich-grid-item-margin: 4px;

        ytd-section-list-renderer > #contents > ytd-item-section-renderer > #contents {
            /* Fix excessive bottom margin */
            > ytd-video-renderer {
                margin-bottom: 0px;
            }

            /* No shorts */
            > grid-shelf-view-model:has(ytm-shorts-lockup-view-model-v2) {
                display: none;
            }
        }
    }

    /* Disable touchy feedbacky ma */
    yt-lockup-view-model > div.yt-lockup-view-model > yt-touch-feedback-shape {
        display: none;
    }

    /* Reduce padding under the like/dislike button */
    ytd-watch-metadata.ytd-watch-flexy > #above-the-fold > #top-row {
        padding-bottom: 4px !important;
    }

    /* Video popup menu */
    .ytp-popup,
    /* Recommended video popup menu */
    .ytSheetViewModelContextual {
        /* Fix corner */
        border-radius: borderRadius !important;
        /* Unblur */
        backdrop-filter: unset !important;
    }

    /* Fix corner for menu */
    tp-yt-paper-item.ytd-menu-service-item-renderer {
        border-radius: 0px !important;
    }

    /* Blur override */
    :root {
        --yt-frosted-glass-backdrop-filter-override: none;
    }

    /* Unblur tophead */
    ytd-masthead:not([frosted-glass-mode = "none"]) > #background.ytd-masthead {
        background: var(--yt-spec-base-background) !important;
        backdrop-filter: unset !important;
    }

    /* Buttons in recommended video */
    yt-thumbnail-hover-overlay-toggle-actions-view-model button {
        /* Fix corner */
        border-radius: buttonRadius !important;
        /* Unblur */
        backdrop-filter: unset !important;
    }

    /* Tiny pp energy ðŸ¤ðŸ† */
    :is(yt-lockup-view-model.ytd-item-section-renderer, yt-lockup-view-model.ytd-watch-next-secondary-results-renderer, ytd-rich-item-renderer.ytd-rich-grid-renderer):not(:hover) a[href *= "&pp="] > yt-thumbnail-view-model img {
        filter: grayscale(100%) blur(2px);
    }

    /* Patch for Youtube Tiny Generals */
    ytd-guide-collapsible-section-entry-renderer.ytd-guide-section-renderer > #header:has(> #header-entry > a[href = "/feed/subscriptions"]) {
        display: flex !important;
    }

    /* Patch margins and compactify comment thread */
    @css {
        yt-sub-thread {
            > .ytSubThreadSubThreadContent {
                margin-top: 0px;
                margin-left: 0.75rem;

                > .show-replies-button {
                    > #creator-thumbnail.ytd-comment-replies-renderer {
                        margin-inline: 0.75rem;
                    }

                    > span.dot {
                        margin: 0px;
                    }
                }

                > .show-replies-button,
                > ytd-continuation-item-renderer > #button,
                & {
                    > ytd-button-renderer > yt-button-shape > button {
                        padding-inline: 0.75rem;
                    }
                }
            }

            &.ytSubThreadHost {
                > .ytSubThreadThreadline > .ytSubThreadConnection {
                    width: calc(100% - 7.5px);
                    height: 15px;
                    border-bottom-left-radius: 15px;
                }

                &:not(.ytSubThreadHasButton:only-of-type) > .ytSubThreadThreadline {
                    width: 15px;

                    > .ytSubThreadConnection {
                        border-bottom-left-radius: 7.5px;
                    }
                }
            }
        }

        ytd-comment-thread-renderer > div.ytd-comment-thread-renderer.thread-hitbox {
            width: 15px !important;
        }

        ytd-comment-view-model > #body > #author-thumbnail {
            margin-right: 0.75rem;

            > div.threadline {
                width: 15px;
            }
        }
    }

    /* Remove margin for recommended videos */
    yt-content-metadata-view-model > .yt-content-metadata-view-model__metadata-row {
        margin-top: 0px;
    }

    /* Reduce padding */
    yt-live-chat-message-input-renderer.yt-live-chat-renderer {
        padding: 5px;

        > #container > #top > #right > #count-container {
            margin-left: 0px;
        }
    }

    /* Weird gap between like button and dropdown menu */
    yt-button-view-model.ytd-menu-renderer:has(> button-view-model:empty:only-child) {
        display: none;
    }
}
